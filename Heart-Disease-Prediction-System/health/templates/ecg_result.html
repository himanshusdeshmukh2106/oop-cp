{% extends 'index.html' %}
{% load static %}

{% block body %}
<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-10">
            <div class="card shadow">
                <div class="card-header {% if ecg_record.prediction_code == 2 %}bg-success{% elif ecg_record.prediction_code == 1 %}bg-danger{% else %}bg-warning{% endif %} text-white">
                    <h3 class="mb-0"><i class="fas fa-file-medical"></i> ECG Analysis Result</h3>
                </div>
                <div class="card-body">
                    
                    <!-- Result Summary -->
                    <div class="alert {% if ecg_record.prediction_code == 2 %}alert-success{% elif ecg_record.prediction_code == 1 %}alert-danger{% else %}alert-warning{% endif %} text-center">
                        <h4><i class="fas fa-heartbeat"></i> {{ ecg_record.prediction_label }}</h4>
                        <p class="mb-0">{{ ecg_record.prediction_message }}</p>
                        {% if ecg_record.confidence %}
                        <small>Confidence: {{ ecg_record.confidence|floatformat:2 }}%</small>
                        {% endif %}
                    </div>
                    
                    <div class="row">
                        <!-- ECG Image -->
                        <div class="col-md-6">
                            <h5>Uploaded ECG Image:</h5>
                            <div class="border rounded p-2 bg-light">
                                <img src="{{ ecg_record.ecg_image.url }}" alt="ECG Image" class="img-fluid">
                            </div>
                            <small class="text-muted">Uploaded: {{ ecg_record.created|date:"M d, Y H:i" }}</small>
                        </div>
                        
                        <!-- Interpretation -->
                        <div class="col-md-6">
                            <h5>What does this mean?</h5>
                            
                            {% if ecg_record.prediction_code == 2 %}
                            <div class="alert alert-success">
                                <h6><i class="fas fa-check-circle"></i> Normal ECG</h6>
                                <p>Your ECG shows normal heart rhythm and electrical activity. This is a good sign!</p>
                                <ul>
                                    <li>Regular heart rhythm</li>
                                    <li>Normal P, QRS, and T waves</li>
                                    <li>No signs of heart disease</li>
                                </ul>
                            </div>
                            {% elif ecg_record.prediction_code == 1 %}
                            <div class="alert alert-danger">
                                <h6><i class="fas fa-exclamation-triangle"></i> Myocardial Infarction Detected</h6>
                                <p><strong>This is a medical emergency!</strong></p>
                                <ul>
                                    <li>Seek immediate medical attention</li>
                                    <li>Call emergency services (911)</li>
                                    <li>Do not drive yourself to hospital</li>
                                    <li>Take aspirin if available and not allergic</li>
                                </ul>
                            </div>
                            {% elif ecg_record.prediction_code == 0 %}
                            <div class="alert alert-warning">
                                <h6><i class="fas fa-heartbeat"></i> Abnormal Heartbeat</h6>
                                <p>Your ECG shows irregular heart rhythm (arrhythmia).</p>
                                <ul>
                                    <li>Consult a cardiologist soon</li>
                                    <li>May require medication or treatment</li>
                                    <li>Monitor symptoms (palpitations, dizziness)</li>
                                    <li>Avoid excessive caffeine and stress</li>
                                </ul>
                            </div>
                            {% elif ecg_record.prediction_code == 3 %}
                            <div class="alert alert-warning">
                                <h6><i class="fas fa-history"></i> History of Myocardial Infarction</h6>
                                <p>Your ECG shows signs of a previous heart attack.</p>
                                <ul>
                                    <li>Follow up with your cardiologist</li>
                                    <li>Continue prescribed medications</li>
                                    <li>Maintain heart-healthy lifestyle</li>
                                    <li>Regular monitoring recommended</li>
                                </ul>
                            </div>
                            {% endif %}
                            
                            <div class="alert alert-info">
                                <strong><i class="fas fa-info-circle"></i> Important Note:</strong>
                                <p class="mb-0">This is an AI-assisted analysis and should not replace professional medical advice. Always consult with a qualified healthcare provider for proper diagnosis and treatment.</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Nearby Doctors -->
                    {% if doctors %}
                    <hr>
                    <h5><i class="fas fa-user-md"></i> Recommended Doctors in Your Area:</h5>
                    <div class="row">
                        {% for doctor in doctors %}
                        <div class="col-md-6 mb-3">
                            <div class="card">
                                <div class="card-body">
                                    <h6>Dr. {{ doctor.user.first_name }} {{ doctor.user.last_name }}</h6>
                                    <p class="mb-1"><i class="fas fa-stethoscope"></i> {{ doctor.category }}</p>
                                    <p class="mb-1"><i class="fas fa-phone"></i> {{ doctor.contact }}</p>
                                    <p class="mb-0"><i class="fas fa-map-marker-alt"></i> {{ doctor.address }}</p>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    {% endif %}
                    
                    <hr>
                    
                    <div class="text-center">
                        <a href="{% url 'upload_ecg' %}" class="btn btn-primary">
                            <i class="fas fa-upload"></i> Analyze Another ECG
                        </a>
                        <a href="{% url 'ecg_history' %}" class="btn btn-outline-secondary">
                            <i class="fas fa-history"></i> View History
                        </a>
                        <a href="{% url 'patient_home' %}" class="btn btn-outline-primary">
                            <i class="fas fa-home"></i> Back to Dashboard
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
